<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <title>AutoComplete with Redis, NodeJS and jQuery</title>
		  <style>
				ul.ui-autocomplete.ui-menu{width:600px}
				.ui-autocomplete { height: 200px; overflow-y: scroll; overflow-x: hidden;}
			</style>
      <link href="http://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
      <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
      <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
      <!-- Javascript -->
      <script>


		$(function(){

			$.ajaxSetup({ scriptCharset: "utf-8" ,contentType: "application/x-www-form-urlencoded; charset=UTF-8" });
			//this is OpenClinica specific
 			var myOutputField = $("#myOutput").parent().parent().find("input");
			myOutputField.attr("readonly",true);

		     $( ".autoicd" ).autocomplete({
		        source: function(req, res){
					var _url="http://127.0.0.1:1337/?autoicd=" 
						+ $(this.element).prop("id") + "&callback=?";
					console.log('req.term: ' + req.term + ": " + _url);
					$.ajax({url: _url,
							dataType: "jsonp",
							data:{
								q: encodeURI(req.term)
							},
							success: function(data){
								res(data);
							},
							error: function(xhr, status, err){
								console.log(status);
								console.log(err);
							}
					});
				},
		        minLength: 2,
				select: function(event, ui){
					if (ui.item){
						$('#selectedIcd9Label').text(ui.item.label);
						$('#myOutput').val(ui.item.label.split(' - ')[0]);
					}
				}
		     });
		});
      </script> 
   </head>
   <body>
      ICD9: <input class="autoicd" id="icd9"><br/>
      ICD9P: <input class="autoicd" id="icd9p"><br/>
      <span id="selectedIcd9Label"></span>
   </body>
</html>
